<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ³‰ã®èŠ± æ¥­å‹™ç®¡ç†ï¼ˆã‚¹ãƒãƒ›æœ€é©åŒ–ç‰ˆï¼‰</title>
    <style>
        /* å…¨ä½“ã®ãƒ™ãƒ¼ã‚¹è¨­å®š */
        :root {
            --primary-color: #007bff;
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --text-color: #333;
            --font-main: 16px; /* æ–‡å­—ã‚’å¤§ããè¨­å®š */
        }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; 
            margin: 0; 
            background: var(--bg-color); 
            color: var(--text-color); 
            line-height: 1.5;
        }

        /* ã‚¿ãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–åŒ– */
        .tab-menu { 
            display: flex; 
            background: #fff; 
            position: sticky; 
            top: 0; 
            z-index: 100; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
        }
        .tab-item { 
            flex: 1; 
            padding: 18px 0; 
            text-align: center; 
            font-weight: bold; 
            color: #666; 
            cursor: pointer; 
            border-bottom: 4px solid transparent; 
            font-size: 1.1rem; /* ã‚¿ãƒ–æ–‡å­—ã‚’å¤§ãã */
        }
        .tab-item.active { 
            color: var(--primary-color); 
            border-bottom: 4px solid var(--primary-color); 
        }

        .container { padding: 12px; max-width: 600px; margin: 0 auto; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* ã‚«ãƒ¼ãƒ‰ãƒ‡ã‚¶ã‚¤ãƒ³ã®èª¿æ•´ */
        .card { 
            background: var(--card-bg); 
            padding: 20px; 
            border-radius: 12px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.05); 
            margin-bottom: 20px; 
        }
        h3 { margin-top: 0; color: var(--primary-color); border-bottom: 2px solid var(--primary-color); padding-bottom: 8px; font-size: 1.3rem; }

        /* å…¥åŠ›è¦ç´ ã‚’ã‚¹ãƒãƒ›ã§ä½¿ã„ã‚„ã™ã */
        label { display: block; font-weight: bold; font-size: 0.9rem; margin-top: 15px; color: #555; }
        select, input, textarea { 
            width: 100%; 
            padding: 14px; 
            margin: 8px 0; 
            border: 1px solid #ccc; 
            border-radius: 8px; 
            box-sizing: border-box; 
            font-size: 1rem; /* å…¥åŠ›æ–‡å­—ã‚‚16pxä»¥ä¸Šã«ï¼ˆiOSã®ã‚ºãƒ¼ãƒ é˜²æ­¢ï¼‰ */
            background: #fafafa;
        }
        button { 
            width: 100%; 
            padding: 16px; 
            background: var(--primary-color); 
            color: white; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 1.1rem; 
            font-weight: bold; 
            margin-top: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        button:active { transform: translateY(2px); box-shadow: none; }

        /* è¨˜éŒ²ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚¹ãƒãƒ›å¯¾å¿œ */
        .filter-section { 
            background: #e9ecef; 
            padding: 15px; 
            border-radius: 8px; 
            margin-bottom: 15px; 
            display: flex; 
            align-items: center; 
            gap: 10px; 
        }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; background: white; border-radius: 8px; overflow: hidden; }
        th, td { border: 1px solid #eee; padding: 12px 8px; text-align: center; font-size: 0.95rem; }
        th { background: #f8f9fa; color: #666; font-size: 0.8rem; }
        .total-row { font-weight: bold; background: #e7f3ff; }
        
        .time-display { color: var(--primary-color); font-weight: bold; font-size: 0.9rem; line-height: 1.2; }
        .staff-badge { display: inline-block; background: #333; color: #fff; padding: 2px 8px; border-radius: 4px; font-weight: bold; font-size: 0.8rem; margin-bottom: 4px; }
        .course-name { font-size: 0.85rem; display: block; color: #444; text-align: left; }
        .delete-btn { background: #ff4d4d; color: white; border: none; padding: 8px 12px; border-radius: 6px; font-size: 0.9rem; }

        /* ãƒ¬ãƒãƒ¼ãƒˆã‚¨ãƒªã‚¢ */
        .report-area { 
            background: #333; 
            color: #0f0; 
            font-family: "Courier New", Courier, monospace; 
            font-size: 0.9rem; 
            height: 250px; 
            padding: 15px;
        }

        /* è¨­å®šãƒªã‚¹ãƒˆ */
        .config-list { padding: 0; list-style: none; }
        .config-list li { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 12px; 
            border-bottom: 1px solid #eee; 
            background: #fff;
            margin-bottom: 4px;
            border-radius: 4px;
        }
    </style>
<link rel="manifest" href="manifest.json">
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js');
  }
</script>
</head>
<body>

<div class="tab-menu">
    <div class="tab-item active" onclick="switchTab('main')">å…¥åŠ›ãƒ»è¨˜éŒ²</div>
    <div class="tab-item" onclick="switchTab('report')">å¸³ç¥¨</div>
    <div class="tab-item" onclick="switchTab('config')">è¨­å®š</div>
</div>

<div class="container">
    <div id="main-tab" class="tab-content active">
        <div class="card">
            <h3>æ³‰ã®èŠ± å…¥åŠ›</h3>
            <label>å®Ÿæ–½æ—¥</label>
            <input type="date" id="date">
            
            <label>æ‹…å½“è€…</label>
            <select id="staffSelect"></select>
            
            <label>ã‚³ãƒ¼ã‚¹</label>
            <select id="itemSelect"></select>
            
            <label>é–‹å§‹æ™‚é–“</label>
            <input type="time" id="startTime">
            
            <button onclick="addData()">ä¿å­˜ã™ã‚‹</button>
        </div>

        <div class="card">
            <h3>è¨˜éŒ²</h3>
            <div class="filter-section">
                <input type="date" id="filterDate" onchange="displayData()" style="margin:0; flex-grow:1;">
                <button style="width:auto; padding:10px 15px; margin:0; font-size:0.9rem; background:#28a745;" onclick="resetFilter()">ã™ã¹ã¦</button>
            </div>
            <div id="tableContainer"></div>
        </div>
    </div>

    <div id="report-tab" class="tab-content">
        <div class="card">
            <h3>æœˆæ¬¡å£²ä¸Šãƒ¬ãƒãƒ¼ãƒˆ</h3>
            <label>å¯¾è±¡å¹´æœˆ</label>
            <input type="month" id="reportMonth">
            <button onclick="generateReport()" style="background:#17a2b8;">ãƒ†ã‚­ã‚¹ãƒˆä½œæˆ</button>
            <textarea id="reportOutput" class="report-area" readonly placeholder="ã“ã“ã«å‡ºåŠ›ã•ã‚Œã¾ã™"></textarea>
            <button onclick="copyReport()" style="background:#6c757d; margin-top:10px;">çµæœã‚’ã‚³ãƒ”ãƒ¼</button>
        </div>
    </div>

    <div id="config-tab" class="tab-content">
        <div class="card">
            <h3>æ‹…å½“è€…ã®ç·¨é›†</h3>
            <input type="text" id="newStaffName" placeholder="æ–°ã—ã„åå‰">
            <button onclick="addStaff()" style="background:#17a2b8; padding:12px;">è¿½åŠ </button>
            <ul id="staffConfigList" class="config-list"></ul>
        </div>
        <div class="card">
            <h3>ã‚³ãƒ¼ã‚¹ã®ç·¨é›†</h3>
            <input type="text" id="newCourseName" placeholder="ã‚³ãƒ¼ã‚¹å">
            <div style="display:flex; gap:10px;">
                <input type="number" id="newCoursePrice" placeholder="é‡‘é¡">
                <input type="number" id="newCourseMin" placeholder="åˆ†æ•°">
            </div>
            <button onclick="addCourse()" style="background:#17a2b8; padding:12px;">è¿½åŠ </button>
            <ul id="courseConfigList" class="config-list"></ul>
        </div>
    </div>
</div>

<script>
    const KEY_REC = 'izumi_v12_rec';
    const KEY_STF = 'izumi_v12_stf';
    const KEY_CRS = 'izumi_v12_crs';

    const defS = ["ç¾å’Œ", "ç¿", "éƒ­"];
    const defC = [
        { cat: "è´…æ²¢çµ„åˆã‚³ãƒ¼ã‚¹", name: "çµ„åˆ70åˆ†(æ•´ä½“40+ãƒ˜ãƒƒãƒ‰10+ç¾è„š20)", price: 8000, min: 70, label: "70åˆ†ï¼š8000å†† (çµ„åˆA)" },
        { cat: "è´…æ²¢çµ„åˆã‚³ãƒ¼ã‚¹", name: "çµ„åˆ70åˆ†(ã‚¢ãƒ­ãƒ60+ãƒ˜ãƒƒãƒ‰10)", price: 9000, min: 70, label: "70åˆ†ï¼š9000å†† (çµ„åˆB)" },
        { cat: "è´…æ²¢çµ„åˆã‚³ãƒ¼ã‚¹", name: "çµ„åˆ90åˆ†(ã‚¢ãƒ­ãƒ50+è¶³è£30+ãƒ˜ãƒƒãƒ‰10)", price: 11000, min: 90, label: "90åˆ†ï¼š11000å†† (çµ„åˆC)" },
        { cat: "è´…æ²¢çµ„åˆã‚³ãƒ¼ã‚¹", name: "çµ„åˆ120åˆ†(ã‚¢ãƒ­ãƒ70+è¶³è£30+ãƒ˜ãƒƒãƒ‰10)", price: 14000, min: 120, label: "120åˆ†ï¼š14000å†† (çµ„åˆD)" },
        { cat: "äººæ°—å®šç•ªã‚³ãƒ¼ã‚¹", name: "æ•´ä½“æŒ‡åœ§ 30åˆ†", price: 3000, min: 30, label: "æ•´ä½“æŒ‡åœ§ 30åˆ† (3,000å††)" },
        { cat: "äººæ°—å®šç•ªã‚³ãƒ¼ã‚¹", name: "æ•´ä½“æŒ‡åœ§ 60åˆ†", price: 5500, min: 60, label: "æ•´ä½“æŒ‡åœ§ 60åˆ† (5,500å††)" },
        { cat: "äººæ°—å®šç•ªã‚³ãƒ¼ã‚¹", name: "ã‚ªã‚¤ãƒ«å…¨èº« 60åˆ†", price: 6000, min: 60, label: "ã‚ªã‚¤ãƒ«å…¨èº« 60åˆ† (6,000å††)" },
        { cat: "äººæ°—å®šç•ªã‚³ãƒ¼ã‚¹", name: "ã‚¢ãƒ­ãƒ 60åˆ†", price: 8000, min: 60, label: "ã‚¢ãƒ­ãƒ 60åˆ† (8,000å††)" },
        { cat: "å˜å“ãƒ»å»¶é•·", name: "æ•´ä½“ 30åˆ†", price: 3000, min: 30, label: "æ•´ä½“ 30åˆ† (3,000å††)" },
        { cat: "å˜å“ãƒ»å»¶é•·", name: "ãƒ˜ãƒƒãƒ‰ã‚¹ãƒ‘ 15åˆ†", price: 2000, min: 15, label: "ãƒ˜ãƒƒãƒ‰ã‚¹ãƒ‘ 15åˆ† (2,000å††)" },
        { cat: "å˜å“ãƒ»å»¶é•·", name: "å»¶é•· 30åˆ†", price: 4000, min: 30, label: "å»¶é•· 30åˆ† (4,000å††)" }
    ];

    window.onload = () => {
        const now = new Date();
        document.getElementById('date').valueAsDate = now;
        document.getElementById('filterDate').valueAsDate = now;
        document.getElementById('reportMonth').value = now.toISOString().substring(0, 7);
        document.getElementById('startTime').value = now.getHours().toString().padStart(2, '0') + ":" + now.getMinutes().toString().padStart(2, '0');
        refresh();
    };

    function switchTab(t) {
        document.querySelectorAll('.tab-item').forEach((el, i) => el.classList.toggle('active', ['main','report','config'][i] === t));
        document.querySelectorAll('.tab-content').forEach((el, i) => el.classList.toggle('active', ['main','report','config'][i] === t));
        window.scrollTo(0,0);
    }

    function refresh() {
        const sList = JSON.parse(localStorage.getItem(KEY_STF)) || defS;
        const customC = JSON.parse(localStorage.getItem(KEY_CRS)) || [];
        document.getElementById('staffSelect').innerHTML = sList.map(s => `<option value="${s}">${s}</option>`).join('');
        
        let courseHtml = '<option value="">-- é¸æŠ --</option>';
        ["è´…æ²¢çµ„åˆã‚³ãƒ¼ã‚¹", "äººæ°—å®šç•ªã‚³ãƒ¼ã‚¹", "å˜å“ãƒ»å»¶é•·"].forEach(cat => {
            courseHtml += `<optgroup label="${cat}">`;
            defC.filter(c => c.cat === cat).forEach(c => {
                courseHtml += `<option value="${c.name}" data-price="${c.price}" data-min="${c.min}">${c.label}</option>`;
            });
            courseHtml += `</optgroup>`;
        });
        if(customC.length > 0) {
            courseHtml += `<optgroup label="ã‚«ã‚¹ã‚¿ãƒ ">`;
            customC.forEach(c => courseHtml += `<option value="${c.name}" data-price="${c.price}" data-min="${c.min}">${c.name} (${c.price}å††)</option>`);
            courseHtml += `</optgroup>`;
        }
        document.getElementById('itemSelect').innerHTML = courseHtml;
        document.getElementById('staffConfigList').innerHTML = sList.map((s, i) => `<li>${s} <button class="delete-btn" onclick="removeStaff(${i})">å‰Š</button></li>`).join('');
        document.getElementById('courseConfigList').innerHTML = customC.map((c, i) => `<li>${c.name} <button class="delete-btn" onclick="removeCourse(${i})">å‰Š</button></li>`).join('');
        displayData();
    }

    function addData() {
        const d = document.getElementById('date').value;
        const s = document.getElementById('staffSelect').value;
        const sel = document.getElementById('itemSelect');
        const opt = sel.options[sel.selectedIndex];
        if(!opt.value) return alert("ã‚³ãƒ¼ã‚¹ã‚’é¸ã‚“ã§ãã ã•ã„");
        const st = document.getElementById('startTime').value;
        const [h, m] = st.split(':').map(Number);
        const etm = h*60+m+parseInt(opt.getAttribute('data-min'));
        const ets = Math.floor(etm/60)%24 + ":" + (etm%60).toString().padStart(2, '0');

        const rec = { id: Date.now(), date: d, staff: s, name: opt.value, price: parseInt(opt.getAttribute('data-price')), startTime: st, endTime: ets };
        let data = JSON.parse(localStorage.getItem(KEY_REC) || '[]');
        data.push(rec);
        localStorage.setItem(KEY_REC, JSON.stringify(data));
        displayData();
    }

    function displayData() {
        const data = JSON.parse(localStorage.getItem(KEY_REC) || '[]');
        const f = document.getElementById('filterDate').value;
        const filtered = f ? data.filter(d => d.date === f) : data;
        const container = document.getElementById('tableContainer');
        if(filtered.length === 0) { container.innerHTML = "<p style='text-align:center;color:gray;padding:20px;'>è¨˜éŒ²ãªã—</p>"; return; }
        
        let htm = "";
        const grouped = filtered.reduce((acc, d) => { acc[d.date] = acc[d.date] || []; acc[d.date].push(d); return acc; }, {});
        Object.keys(grouped).sort().reverse().forEach(dt => {
            let total = 0; htm += `<h4 style="margin:15px 0 5px; font-size:1rem;">ğŸ“… ${dt}</h4><table>`;
            grouped[dt].sort((a,b)=>a.startTime.localeCompare(b.startTime)).forEach(d => {
                total += d.price;
                htm += `<tr>
                    <td class="time-display">${d.startTime}<br>~${d.endTime}</td>
                    <td><span class="staff-badge">${d.staff}</span><br><span class="course-name">${d.name}</span></td>
                    <td style="font-weight:bold">${d.price.toLocaleString()}</td>
                    <td><button class="delete-btn" onclick="deleteData(${d.id})">Ã—</button></td>
                </tr>`;
            });
            htm += `<tr class="total-row"><td colspan="2">åˆè¨ˆå£²ä¸Š</td><td colspan="2">${total.toLocaleString()}å††</td></tr></table>`;
        });
        container.innerHTML = htm;
    }

    function deleteData(id) { if(confirm("æ¶ˆå»ã—ã¾ã™ã‹ï¼Ÿ")) { let data = JSON.parse(localStorage.getItem(KEY_REC)||'[]'); data = data.filter(d=>d.id!==id); localStorage.setItem(KEY_REC, JSON.stringify(data)); displayData(); } }
    function resetFilter() { document.getElementById('filterDate').value = ""; displayData(); }

    function generateReport() {
        const month = document.getElementById('reportMonth').value;
        if(!month) return alert("å¹´æœˆã‚’é¸ã‚“ã§ãã ã•ã„");
        const data = JSON.parse(localStorage.getItem(KEY_REC) || '[]');
        const filtered = data.filter(d => d.date.startsWith(month)).sort((a,b) => a.date.localeCompare(b.date) || a.startTime.localeCompare(b.startTime));
        let total = 0; let staffS = {}; let text = `ã€${month} å£²ä¸Šå ±å‘Šã€‘\n---\n`;
        filtered.forEach(d => { text += `${d.date.substring(8)}æ—¥ ${d.startTime} [${d.staff}] ${d.price}å††\n`; total += d.price; staffS[d.staff] = (staffS[d.staff] || 0) + d.price; });
        text += `---\nâ– ã‚¹ã‚¿ãƒƒãƒ•åˆ¥\n`;
        for(let s in staffS) text += ` ãƒ»${s}: ${staffS[s].toLocaleString()}å††\n`;
        text += `---\nâ˜…æœˆé–“åˆè¨ˆ: ${total.toLocaleString()}å††`;
        document.getElementById('reportOutput').value = text;
    }
    function copyReport() { const out = document.getElementById('reportOutput'); out.select(); out.setSelectionRange(0, 99999); document.execCommand('copy'); alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ"); }
    function addStaff() { const name = document.getElementById('newStaffName').value.trim(); if(!name) return; const l = JSON.parse(localStorage.getItem(KEY_STF)) || defS; l.push(name); localStorage.setItem(KEY_STF, JSON.stringify(l)); document.getElementById('newStaffName').value=''; refresh(); }
    function removeStaff(i) { const l = JSON.parse(localStorage.getItem(KEY_STF)) || defS; l.splice(i,1); localStorage.setItem(KEY_STF, JSON.stringify(l)); refresh(); }
    function addCourse() { const n = document.getElementById('newCourseName').value.trim(); const p = parseInt(document.getElementById('newCoursePrice').value); const m = parseInt(document.getElementById('newCourseMin').value); if(!n || isNaN(p) || isNaN(m)) return alert("æ­£ã—ãå…¥åŠ›ã—ã¦ãã ã•ã„"); const l = JSON.parse(localStorage.getItem(KEY_CRS)) || []; l.push({name: n, price: p, min: m}); localStorage.setItem(KEY_CRS, JSON.stringify(l)); document.getElementById('newCourseName').value=''; document.getElementById('newCoursePrice').value=''; document.getElementById('newCourseMin').value=''; refresh(); }
    function removeCourse(i) { const l = JSON.parse(localStorage.getItem(KEY_CRS)) || []; l.splice(i,1); localStorage.setItem(KEY_CRS, JSON.stringify(l)); refresh(); }
</script>
</body>
</html>