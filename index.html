<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ³‰ã®èŠ± æ¥­å‹™ç®¡ç†ï¼ˆçµ¦æ–™è¨ˆç®—ç‰ˆï¼‰</title>
    <style>
        :root { --primary: #007bff; --bg: #f0f2f5; --card: #fff; }
        body { font-family: sans-serif; margin: 0; background: var(--bg); color: #333; line-height: 1.5; }
        .tab-menu { display: flex; background: #fff; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .tab-item { flex: 1; padding: 18px 0; text-align: center; font-weight: bold; color: #666; cursor: pointer; border-bottom: 4px solid transparent; font-size: 1.1rem; }
        .tab-item.active { color: var(--primary); border-bottom: 4px solid var(--primary); }
        .container { padding: 12px; max-width: 600px; margin: 0 auto; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .card { background: var(--card); padding: 20px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px; }
        h3 { margin-top: 0; color: var(--primary); border-bottom: 2px solid var(--primary); padding-bottom: 8px; font-size: 1.3rem; }
        label { display: block; font-weight: bold; font-size: 0.9rem; margin-top: 15px; color: #555; }
        select, input, textarea { width: 100%; padding: 14px; margin: 8px 0; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 1rem; background: #fafafa; }
        /* çµ¦æ–™å…¥åŠ›æ¬„ã‚’ç›®ç«‹ãŸã›ã‚‹ */
        #salaryInput { background: #fff9db; border: 2px solid #fab005; font-weight: bold; color: #e67700; }
        button { width: 100%; padding: 16px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1.1rem; font-weight: bold; margin-top: 10px; }
        .filter-section { background: #e9ecef; padding: 15px; border-radius: 8px; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; background: white; border-radius: 8px; overflow: hidden; }
        th, td { border: 1px solid #eee; padding: 12px 8px; text-align: center; font-size: 0.9rem; }
        th { background: #f8f9fa; font-size: 0.75rem; }
        .total-row { font-weight: bold; background: #e7f3ff; }
        .staff-badge { display: inline-block; background: #333; color: #fff; padding: 2px 8px; border-radius: 4px; font-weight: bold; font-size: 0.8rem; margin-bottom: 4px; }
        .salary-text { color: #e67700; font-size: 0.8rem; font-weight: bold; }
        .delete-btn { background: #ff4d4d; color: white; border: none; padding: 8px 12px; border-radius: 6px; }
        .report-area { background: #333; color: #0f0; font-family: monospace; font-size: 0.9rem; height: 250px; padding: 15px; width: 100%; box-sizing: border-box; }
    </style>
</head>
<body>

<div class="tab-menu">
    <div class="tab-item active" onclick="switchTab('main')">å…¥åŠ›ãƒ»è¨˜éŒ²</div>
    <div class="tab-item" onclick="switchTab('report')">å¸³ç¥¨</div>
    <div class="tab-item" onclick="switchTab('config')">è¨­å®š</div>
</div>

<div class="container">
    <div id="main-tab" class="tab-content active">
        <div class="card">
            <h3>æ³‰ã®èŠ± å…¥åŠ›</h3>
            <label>å®Ÿæ–½æ—¥</label>
            <input type="date" id="date">
            <label>æ‹…å½“è€…</label>
            <select id="staffSelect"></select>
            <label>ã‚³ãƒ¼ã‚¹ï¼ˆé¸ã¶ã¨çµ¦æ–™ãŒè‡ªå‹•è¨ˆç®—ã•ã‚Œã¾ã™ï¼‰</label>
            <select id="itemSelect" onchange="calcSalary()"></select>
            <label>çµ¦æ–™ï¼ˆ50%ã§è‡ªå‹•ç®—å‡ºã€æ‰‹ä¿®æ­£å¯ï¼‰</label>
            <input type="number" id="salaryInput" placeholder="çµ¦æ–™é¡">
            <label>é–‹å§‹æ™‚é–“</label>
            <input type="time" id="startTime">
            <button onclick="addData()">ä¿å­˜ã™ã‚‹</button>
        </div>

        <div class="card">
            <h3>è¨˜éŒ²</h3>
            <div class="filter-section">
                <input type="date" id="filterDate" onchange="displayData()" style="margin:0; flex-grow:1;">
                <button style="width:auto; padding:10px 15px; margin:0; font-size:0.9rem; background:#28a745;" onclick="resetFilter()">ã™ã¹ã¦</button>
            </div>
            <div id="tableContainer"></div>
        </div>
    </div>

    <div id="report-tab" class="tab-content">
        <div class="card">
            <h3>æœˆæ¬¡å£²ä¸Šãƒ¬ãƒãƒ¼ãƒˆ</h3>
            <input type="month" id="reportMonth">
            <button onclick="generateReport()" style="background:#17a2b8;">ãƒ†ã‚­ã‚¹ãƒˆä½œæˆ</button>
            <textarea id="reportOutput" class="report-area" readonly></textarea>
            <button onclick="copyReport()" style="background:#6c757d; margin-top:10px;">çµæœã‚’ã‚³ãƒ”ãƒ¼</button>
        </div>
    </div>

    <div id="config-tab" class="tab-content">
        <div class="card"><h3>æ‹…å½“è€…ç·¨é›†</h3><input type="text" id="newStaffName"><button onclick="addStaff()" style="background:#17a2b8;">è¿½åŠ </button><ul id="staffConfigList"></ul></div>
        <div class="card"><h3>ã‚³ãƒ¼ã‚¹ç·¨é›†</h3><input type="text" id="newCourseName"><div style="display:flex;gap:10px;"><input type="number" id="newCoursePrice" placeholder="å£²ä¸Šé¡"><input type="number" id="newCourseMin" placeholder="åˆ†"></div><button onclick="addCourse()" style="background:#17a2b8;">è¿½åŠ </button><ul id="courseConfigList"></ul></div>
    </div>
</div>

<script>
    const KEY_REC = 'izumi_v13_rec';
    const KEY_STF = 'izumi_v13_stf';
    const KEY_CRS = 'izumi_v13_crs';
    const defS = ["ç¾å’Œ", "ç¿", "éƒ­"];
    const defC = [
        { cat: "è´…æ²¢çµ„åˆã‚³ãƒ¼ã‚¹", name: "çµ„åˆ70åˆ†(æ•´ä½“40+ãƒ˜ãƒƒãƒ‰10+ç¾è„š20)", price: 8000, min: 70, label: "70åˆ†ï¼š8000å†† (çµ„åˆA)" },
        { cat: "è´…æ²¢çµ„åˆã‚³ãƒ¼ã‚¹", name: "çµ„åˆ70åˆ†(ã‚¢ãƒ­ãƒ60+ãƒ˜ãƒƒãƒ‰10)", price: 9000, min: 70, label: "70åˆ†ï¼š9000å†† (çµ„åˆB)" },
        { cat: "è´…æ²¢çµ„åˆã‚³ãƒ¼ã‚¹", name: "çµ„åˆ90åˆ†(ã‚¢ãƒ­ãƒ50+è¶³è£30+ãƒ˜ãƒƒãƒ‰10)", price: 11000, min: 90, label: "90åˆ†ï¼š11000å†† (çµ„åˆC)" },
        { cat: "è´…æ²¢çµ„åˆã‚³ãƒ¼ã‚¹", name: "çµ„åˆ120åˆ†(ã‚¢ãƒ­ãƒ70+è¶³è£30+ãƒ˜ãƒƒãƒ‰10)", price: 14000, min: 120, label: "120åˆ†ï¼š14000å†† (çµ„åˆD)" },
        { cat: "äººæ°—å®šç•ªã‚³ãƒ¼ã‚¹", name: "æ•´ä½“æŒ‡åœ§ 60åˆ†", price: 5500, min: 60, label: "æ•´ä½“æŒ‡åœ§ 60åˆ† (5,500å††)" },
        { cat: "äººæ°—å®šç•ªã‚³ãƒ¼ã‚¹", name: "ã‚¢ãƒ­ãƒ 60åˆ†", price: 8000, min: 60, label: "ã‚¢ãƒ­ãƒ 60åˆ† (8,000å††)" }
    ];

    window.onload = () => {
        const now = new Date();
        document.getElementById('date').valueAsDate = now;
        document.getElementById('filterDate').valueAsDate = now;
        document.getElementById('reportMonth').value = now.toISOString().substring(0, 7);
        document.getElementById('startTime').value = now.getHours().toString().padStart(2, '0') + ":" + now.getMinutes().toString().padStart(2, '0');
        refresh();
    };

    function calcSalary() {
        const sel = document.getElementById('itemSelect');
        const opt = sel.options[sel.selectedIndex];
        if(!opt.value) return;
        const price = parseInt(opt.getAttribute('data-price'));
        // 50%ã‚’è‡ªå‹•è¨ˆç®—
        document.getElementById('salaryInput').value = Math.floor(price * 0.5);
    }

    function switchTab(t) {
        document.querySelectorAll('.tab-item').forEach((el, i) => el.classList.toggle('active', ['main','report','config'][i] === t));
        document.querySelectorAll('.tab-content').forEach((el, i) => el.classList.toggle('active', ['main','report','config'][i] === t));
    }

    function addData() {
        const d = document.getElementById('date').value;
        const s = document.getElementById('staffSelect').value;
        const sel = document.getElementById('itemSelect');
        const opt = sel.options[sel.selectedIndex];
        const salary = parseInt(document.getElementById('salaryInput').value);
        if(!opt.value || isNaN(salary)) return alert("ã‚³ãƒ¼ã‚¹ã¨çµ¦æ–™ã‚’ç¢ºèªã—ã¦ãã ã•ã„");
        
        const st = document.getElementById('startTime').value;
        const [h, m] = st.split(':').map(Number);
        const etm = h*60+m+parseInt(opt.getAttribute('data-min'));
        const ets = Math.floor(etm/60)%24 + ":" + (etm%60).toString().padStart(2, '0');

        const rec = { id: Date.now(), date: d, staff: s, name: opt.value, price: parseInt(opt.getAttribute('data-price')), salary: salary, startTime: st, endTime: ets };
        let data = JSON.parse(localStorage.getItem(KEY_REC) || '[]');
        data.push(rec);
        localStorage.setItem(KEY_REC, JSON.stringify(data));
        displayData();
        // å…¥åŠ›æ¬„ã‚’ã‚¯ãƒªã‚¢
        document.getElementById('salaryInput').value = '';
        sel.selectedIndex = 0;
    }

    function displayData() {
        const data = JSON.parse(localStorage.getItem(KEY_REC) || '[]');
        const f = document.getElementById('filterDate').value;
        const filtered = f ? data.filter(d => d.date === f) : data;
        const container = document.getElementById('tableContainer');
        if(filtered.length === 0) { container.innerHTML = "<p style='text-align:center;color:gray;padding:20px;'>ãªã—</p>"; return; }
        
        let htm = "";
        const grouped = filtered.reduce((acc, d) => { acc[d.date] = acc[d.date] || []; acc[d.date].push(d); return acc; }, {});
        Object.keys(grouped).sort().reverse().forEach(dt => {
            let totalP = 0; let totalS = 0;
            htm += `<h4 style="margin:15px 0 5px; font-size:1rem;">ğŸ“… ${dt}</h4><table><tr><th>æ™‚é–“</th><th>æ‹…å½“/é …ç›®</th><th>å£²ä¸Š/çµ¦æ–™</th><th></th></tr>`;
            grouped[dt].sort((a,b)=>a.startTime.localeCompare(b.startTime)).forEach(d => {
                totalP += d.price; totalS += d.salary;
                htm += `<tr>
                    <td>${d.startTime}<br>~${d.endTime}</td>
                    <td style="text-align:left"><span class="staff-badge">${d.staff}</span><br><span style="font-size:0.75rem">${d.name}</span></td>
                    <td>${d.price.toLocaleString()}<br><span class="salary-text">çµ¦:${d.salary.toLocaleString()}</span></td>
                    <td><button class="delete-btn" onclick="deleteData(${d.id})" style="padding:5px 8px;">Ã—</button></td>
                </tr>`;
            });
            htm += `<tr class="total-row"><td colspan="2">åˆè¨ˆ</td><td colspan="2">å£²:${totalP.toLocaleString()}<br>çµ¦:${totalS.toLocaleString()}</td></tr></table>`;
        });
        container.innerHTML = htm;
    }

    function generateReport() {
        const month = document.getElementById('reportMonth').value;
        if(!month) return alert("å¹´æœˆé¸æŠ");
        const data = JSON.parse(localStorage.getItem(KEY_REC) || '[]');
        const filtered = data.filter(d => d.date.startsWith(month)).sort((a,b) => a.date.localeCompare(b.date) || a.startTime.localeCompare(b.startTime));
        let tP = 0; let tS = 0; let stP = {}; let stS = {};
        let text = `ã€${month} ãƒ¬ãƒãƒ¼ãƒˆã€‘\n---\n`;
        filtered.forEach(d => {
            text += `${d.date.substring(8)}æ—¥ ${d.startTime} [${d.staff}] å£²:${d.price} çµ¦:${d.salary}\n`;
            tP += d.price; tS += d.salary;
            stP[d.staff] = (stP[d.staff] || 0) + d.price;
            stS[d.staff] = (stS[d.staff] || 0) + d.salary;
        });
        text += `---\nâ– ã‚¹ã‚¿ãƒƒãƒ•åˆ¥ (å£²ä¸Š / çµ¦æ–™)\n`;
        for(let s in stP) text += ` ãƒ»${s}: ${stP[s].toLocaleString()} / ${stS[s].toLocaleString()}å††\n`;
        text += `---\nâ˜…æœˆé–“åˆè¨ˆ å£²ä¸Š: ${tP.toLocaleString()}å††\nâ˜…æœˆé–“åˆè¨ˆ çµ¦æ–™: ${tS.toLocaleString()}å††`;
        document.getElementById('reportOutput').value = text;
    }

    // è£œåŠ©é–¢æ•°ç¾¤
    function refresh() {
        const sList = JSON.parse(localStorage.getItem(KEY_STF)) || defS;
        const customC = JSON.parse(localStorage.getItem(KEY_CRS)) || [];
        document.getElementById('staffSelect').innerHTML = sList.map(s => `<option value="${s}">${s}</option>`).join('');
        let cHtml = '<option value="">-- ã‚³ãƒ¼ã‚¹é¸æŠ --</option>';
        ["è´…æ²¢çµ„åˆã‚³ãƒ¼ã‚¹", "äººæ°—å®šç•ªã‚³ãƒ¼ã‚¹", "å˜å“ãƒ»å»¶é•·"].forEach(cat => {
            cHtml += `<optgroup label="${cat}">`;
            defC.filter(c => c.cat === cat).forEach(c => cHtml += `<option value="${c.name}" data-price="${c.price}" data-min="${c.min}">${c.label}</option>`);
            cHtml += `</optgroup>`;
        });
        if(customC.length > 0) {
            cHtml += `<optgroup label="ã‚«ã‚¹ã‚¿ãƒ ">`;
            customC.forEach(c => cHtml += `<option value="${c.name}" data-price="${c.price}" data-min="${c.min}">${c.name} (${c.price}å††)</option>`);
            cHtml += `</optgroup>`;
        }
        document.getElementById('itemSelect').innerHTML = cHtml;
        document.getElementById('staffConfigList').innerHTML = sList.map((s,i) => `<li style="display:flex;justify-content:space-between;padding:10px;border-bottom:1px solid #eee;">${s}<button onclick="removeStaff(${i})" style="width:auto;padding:5px;background:#6c757d;">å‰Šé™¤</button></li>`).join('');
        document.getElementById('courseConfigList').innerHTML = customC.map((c,i) => `<li style="padding:10px;border-bottom:1px solid #eee;">${c.name} (${c.price}å††)<button onclick="removeCourse(${i})" style="float:right;width:auto;padding:5px;background:#6c757d;">å‰Šé™¤</button></li>`).join('');
        displayData();
    }
    function copyReport() { const o = document.getElementById('reportOutput'); o.select(); document.execCommand('copy'); alert("ã‚³ãƒ”ãƒ¼å®Œäº†"); }
    function resetFilter() { document.getElementById('filterDate').value = ""; displayData(); }
    function deleteData(id) { if(confirm("æ¶ˆå»ï¼Ÿ")) { let d = JSON.parse(localStorage.getItem(KEY_REC)||'[]'); d = d.filter(x=>x.id!==id); localStorage.setItem(KEY_REC, JSON.stringify(d)); displayData(); } }
    function addStaff() { const n = document.getElementById('newStaffName').value; if(!n) return; let l = JSON.parse(localStorage.getItem(KEY_STF))||defS; l.push(n); localStorage.setItem(KEY_STF, JSON.stringify(l)); refresh(); }
    function removeStaff(i) { let l = JSON.parse(localStorage.getItem(KEY_STF))||defS; l.splice(i,1); localStorage.setItem(KEY_STF, JSON.stringify(l)); refresh(); }
    function addCourse() { const n = document.getElementById('newCourseName').value; const p = parseInt(document.getElementById('newCoursePrice').value); const m = parseInt(document.getElementById('newCourseMin').value); if(!n||isNaN(p)) return; let l = JSON.parse(localStorage.getItem(KEY_CRS))||[]; l.push({name:n, price:p, min:m}); localStorage.setItem(KEY_CRS, JSON.stringify(l)); refresh(); }
    function removeCourse(i) { let l = JSON.parse(localStorage.getItem(KEY_CRS))||[]; l.splice(i,1); localStorage.setItem(KEY_CRS, JSON.stringify(l)); refresh(); }
</script>
</body>
</html>
